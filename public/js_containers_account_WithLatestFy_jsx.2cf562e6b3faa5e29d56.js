"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunk"] = self["webpackChunk"] || []).push([["js_containers_account_WithLatestFy_jsx"],{

/***/ "./js/containers/account/WithLatestFy.jsx":
/*!************************************************!*\
  !*** ./js/containers/account/WithLatestFy.jsx ***!
  \************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   \"useLatestAccountData\": () => (/* binding */ useLatestAccountData),\n/* harmony export */   \"useValidTimeBasedQueryParams\": () => (/* binding */ useValidTimeBasedQueryParams)\n/* harmony export */ });\n/* harmony import */ var _babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime/helpers/extends */ \"../node_modules/@babel/runtime/helpers/esm/extends.js\");\n/* harmony import */ var _babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime/helpers/slicedToArray */ \"../node_modules/@babel/runtime/helpers/esm/slicedToArray.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! react */ \"../node_modules/react/index.js\");\n/* harmony import */ var react_router_dom__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! react-router-dom */ \"../node_modules/react-router/esm/react-router.js\");\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! axios */ \"../node_modules/axios/index.js\");\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(axios__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var react_redux__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! react-redux */ \"../node_modules/react-redux/es/index.js\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! lodash */ \"../node_modules/lodash/lodash.js\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var _redux_actions_account_accountActions__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../redux/actions/account/accountActions */ \"./js/redux/actions/account/accountActions.js\");\n/* harmony import */ var _helpers_accountHelper__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../helpers/accountHelper */ \"./js/helpers/accountHelper.js\");\n/* harmony import */ var _apis_account__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../apis/account */ \"./js/apis/account.js\");\n/* harmony import */ var _helpers_aboutTheDataHelper__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../helpers/aboutTheDataHelper */ \"./js/helpers/aboutTheDataHelper.js\");\n/* harmony import */ var _helpers_queryParams__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../helpers/queryParams */ \"./js/helpers/queryParams.js\");\n/* module decorator */ module = __webpack_require__.hmd(module);\n\n\n(function () {\n  var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;\n  enterModule && enterModule(module);\n})();\nvar __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {\n  return a;\n};\n\n\n\n\n\n\n\n\n\n\n\n// TODO: Refactor existing consumers of WithLatestFy to use this custom hook\nvar useLatestAccountData = function useLatestAccountData() {\n  var dispatch = (0,react_redux__WEBPACK_IMPORTED_MODULE_4__.useDispatch)();\n  var _useState = (0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(true),\n    _useState2 = (0,_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(_useState, 2),\n    isLoading = _useState2[0],\n    setIsLoading = _useState2[1];\n  var _useState3 = (0,react__WEBPACK_IMPORTED_MODULE_2__.useState)(''),\n    _useState4 = (0,_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(_useState3, 2),\n    errorMsg = _useState4[0],\n    setErrorMsg = _useState4[1];\n  var _useSelector = (0,react_redux__WEBPACK_IMPORTED_MODULE_4__.useSelector)(function (state) {\n      return state.account;\n    }),\n    submissionPeriods = _useSelector.submissionPeriods;\n  var _useState5 = (0,react__WEBPACK_IMPORTED_MODULE_2__.useState)({\n      latestPeriod: (0,_helpers_accountHelper__WEBPACK_IMPORTED_MODULE_7__.getLatestPeriod)([]),\n      latestMoment: null\n    }),\n    _useState6 = (0,_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(_useState5, 2),\n    _useState6$ = _useState6[0],\n    latestMoment = _useState6$.latestMoment,\n    latestPeriod = _useState6$.latestPeriod,\n    setLatestData = _useState6[1];\n  var request = (0,react__WEBPACK_IMPORTED_MODULE_2__.useRef)();\n  (0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(function () {\n    if (submissionPeriods.size && isLoading) {\n      setIsLoading(false);\n    }\n    if (!submissionPeriods.size) {\n      setIsLoading(true);\n      setErrorMsg('');\n      request.current = (0,_apis_account__WEBPACK_IMPORTED_MODULE_8__.fetchAllSubmissionDates)();\n      request.current.promise.then(function (_ref) {\n        var periods = _ref.data.available_periods;\n        dispatch((0,_redux_actions_account_accountActions__WEBPACK_IMPORTED_MODULE_6__.setSubmissionPeriods)(periods));\n        (0,_helpers_accountHelper__WEBPACK_IMPORTED_MODULE_7__.getLatestPeriodAsMoment)(periods);\n        setLatestData({\n          latestMoment: (0,_helpers_accountHelper__WEBPACK_IMPORTED_MODULE_7__.getLatestPeriodAsMoment)(periods),\n          latestPeriod: (0,_helpers_accountHelper__WEBPACK_IMPORTED_MODULE_7__.getLatestPeriod)(periods)\n        });\n        setIsLoading(false);\n        request.current = null;\n      }).catch(function (e) {\n        if (!(0,axios__WEBPACK_IMPORTED_MODULE_3__.isCancel)(e)) {\n          console.error('Error fetching active periods: ', e);\n          setErrorMsg((0,lodash__WEBPACK_IMPORTED_MODULE_5__.get)(e, 'message', 'Error fetching active periods. Please refresh your browser.'));\n          request.current = null;\n        }\n      });\n    } else if (!latestMoment || !latestPeriod) {\n      setLatestData({\n        latestMoment: (0,_helpers_accountHelper__WEBPACK_IMPORTED_MODULE_7__.getLatestPeriodAsMoment)(submissionPeriods.toJS()),\n        latestPeriod: (0,_helpers_accountHelper__WEBPACK_IMPORTED_MODULE_7__.getLatestPeriod)(submissionPeriods.toJS())\n      });\n    }\n    return function () {\n      if (request.current) {\n        console.info('cancelling request, fetchAllSubmissionDates');\n        request.current.cancel();\n      }\n    };\n  }, [dispatch, submissionPeriods]);\n  return [latestMoment, submissionPeriods, latestPeriod, isLoading, errorMsg];\n};\n\n/*\n    * useValidTimeBasedQueryParams\n    * this function enforces validation logic for fiscal years and fiscal periods in the URL as query params\n    * by using the latest submission periods as a reference.\n*/\n__signature__(useLatestAccountData, \"useDispatch{dispatch}\\nuseState{[isLoading, setIsLoading](true)}\\nuseState{[errorMsg, setErrorMsg]('')}\\nuseSelector{{ submissionPeriods }}\\nuseState{[{ latestMoment, latestPeriod }, setLatestData]({ latestPeriod: getLatestPeriod([]), latestMoment: null })}\\nuseRef{request}\\nuseEffect{}\", function () {\n  return [react_redux__WEBPACK_IMPORTED_MODULE_4__.useDispatch, react_redux__WEBPACK_IMPORTED_MODULE_4__.useSelector];\n});\nvar useValidTimeBasedQueryParams = function useValidTimeBasedQueryParams(currentUrlFy) {\n  var currentUrlPeriod = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  var requiredParams = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : ['fy', 'period'];\n  var history = (0,react_router_dom__WEBPACK_IMPORTED_MODULE_11__.useHistory)();\n  var existingParams = (0,_helpers_queryParams__WEBPACK_IMPORTED_MODULE_10__.useQueryParams)();\n  // eslint-disable-next-line eqeqeq\n  if (existingParams.fy && existingParams.fy != parseInt(existingParams.fy, 10)) {\n    existingParams.fy = null;\n  }\n  // eslint-disable-next-line eqeqeq\n  if (existingParams.period && existingParams.period != parseInt(existingParams.period, 10)) {\n    existingParams.period = null;\n  }\n  var _useLatestAccountData = useLatestAccountData(),\n    _useLatestAccountData2 = (0,_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(_useLatestAccountData, 3),\n    submissionPeriods = _useLatestAccountData2[1],\n    latestSubmission = _useLatestAccountData2[2];\n  var latestFy = latestSubmission.year,\n    latestPeriod = latestSubmission.period;\n  var _useState7 = (0,react__WEBPACK_IMPORTED_MODULE_2__.useState)({\n      period: '',\n      fy: ''\n    }),\n    _useState8 = (0,_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(_useState7, 2),\n    _useState8$ = _useState8[0],\n    period = _useState8$.period,\n    fy = _useState8$.fy,\n    setYearAndPeriod = _useState8[1];\n  var updateUrl = function updateUrl(newParamsAsObj) {\n    var newQueryParams = (0,_helpers_queryParams__WEBPACK_IMPORTED_MODULE_10__.combineQueryParams)(existingParams, newParamsAsObj);\n    setYearAndPeriod(newParamsAsObj);\n    history.replace({\n      pathname: \"\",\n      search: (0,_helpers_queryParams__WEBPACK_IMPORTED_MODULE_10__.getQueryParamString)(newQueryParams)\n    });\n  };\n  var handleTimeChange = (0,react__WEBPACK_IMPORTED_MODULE_2__.useCallback)(function (y) {\n    var p = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    if (y && p) {\n      updateUrl({\n        fy: \"\".concat(y),\n        period: \"\".concat(p)\n      });\n    } else if (y) {\n      updateUrl({\n        fy: \"\".concat(y)\n      });\n    } else if (p) {\n      updateUrl({\n        period: \"\".concat(p)\n      });\n    }\n  });\n  (0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(function () {\n    // Handles defining undefined params\n    var isDataReadyForLatest = submissionPeriods.size && latestFy && latestPeriod;\n    var periodAndFyRequired = requiredParams.includes('fy') && requiredParams.includes('period');\n    if (isDataReadyForLatest && requiredParams.some(function (p) {\n      return !existingParams[p];\n    })) {\n      if (periodAndFyRequired && !existingParams.fy && existingParams.period) {\n        handleTimeChange(latestFy);\n      }\n      // only need to update the fy\n      else if (periodAndFyRequired && existingParams.fy && !existingParams.period) {\n        handleTimeChange(null, latestPeriod);\n      }\n      // only need to update the period\n      else if (periodAndFyRequired && !existingParams.fy && !existingParams.period) {\n        handleTimeChange(latestFy, latestPeriod);\n      } else if (isDataReadyForLatest && requiredParams.includes('fy') && !existingParams.fy) {\n        handleTimeChange(latestFy);\n      } else if (isDataReadyForLatest && requiredParams.includes('period') && !existingParams.period) {\n        handleTimeChange(null, latestPeriod);\n      }\n    }\n  }, [history, latestFy, latestPeriod, submissionPeriods.size, currentUrlFy, currentUrlPeriod]);\n  (0,react__WEBPACK_IMPORTED_MODULE_2__.useEffect)(function () {\n    // Handles validating defined params\n    if (submissionPeriods.size && latestFy && latestPeriod && requiredParams.every(function (p) {\n      return existingParams[p];\n    })) {\n      var availablePeriodsInFy = submissionPeriods.toJS().filter(function (_ref2) {\n        var y = _ref2.submission_fiscal_year;\n        return parseInt(currentUrlFy, 10) === y;\n      });\n      if (availablePeriodsInFy.length && currentUrlPeriod) {\n        // fy selection is valid but what about the period? 🤔\n        var validPeriod = (0,_helpers_aboutTheDataHelper__WEBPACK_IMPORTED_MODULE_9__.isPeriodVisible)(availablePeriodsInFy, currentUrlPeriod) ? currentUrlPeriod : \"\".concat(latestPeriod);\n        var selectablePeriod = (0,_helpers_aboutTheDataHelper__WEBPACK_IMPORTED_MODULE_9__.isPeriodSelectable)(availablePeriodsInFy, validPeriod) ? validPeriod : (0,_helpers_aboutTheDataHelper__WEBPACK_IMPORTED_MODULE_9__.getLastPeriodWithinQuarterByPeriod)(validPeriod);\n        handleTimeChange(currentUrlFy, selectablePeriod);\n      } else if (currentUrlPeriod) {\n        // invalid time selection, use the latest available fy/period 👌\n        handleTimeChange(latestFy, latestPeriod);\n      } else if (availablePeriodsInFy.length) {\n        handleTimeChange(currentUrlFy);\n      } else {\n        handleTimeChange(latestFy);\n      }\n    }\n  }, [submissionPeriods, currentUrlFy, currentUrlPeriod, latestPeriod, latestFy]);\n  if (requiredParams.length === 1 && requiredParams[0] === 'fy') return [fy, updateUrl];\n  return [fy, period && latestPeriod ? (0,_helpers_aboutTheDataHelper__WEBPACK_IMPORTED_MODULE_9__.getPeriodWithTitleById)(period, latestPeriod) : period, updateUrl];\n};\n__signature__(useValidTimeBasedQueryParams, \"useHistory{history}\\nuseQueryParams{existingParams}\\nuseLatestAccountData{[, submissionPeriods, latestSubmission]}\\nuseState{[{ period, fy }, setYearAndPeriod]({ period: '', fy: '' })}\\nuseCallback{handleTimeChange}\\nuseEffect{}\\nuseEffect{}\", function () {\n  return [react_router_dom__WEBPACK_IMPORTED_MODULE_11__.useHistory, _helpers_queryParams__WEBPACK_IMPORTED_MODULE_10__.useQueryParams, useLatestAccountData];\n});\nvar withLatestFy = function withLatestFy(WrappedComponent) {\n  var format = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  return __signature__(function (props) {\n    var _useLatestAccountData3 = useLatestAccountData(),\n      _useLatestAccountData4 = (0,_babel_runtime_helpers_slicedToArray__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(_useLatestAccountData3, 5),\n      latestPeriodAsMoment = _useLatestAccountData4[0],\n      submissionPeriods = _useLatestAccountData4[1],\n      latestPeriod = _useLatestAccountData4[2],\n      isLoading = _useLatestAccountData4[3],\n      errorMsg = _useLatestAccountData4[4];\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_2__.createElement(WrappedComponent, (0,_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_0__[\"default\"])({}, props, {\n      isFetchLatestFyLoading: isLoading,\n      fetchLatestFyError: errorMsg,\n      latestSubmissionDate: latestPeriodAsMoment && format ? latestPeriodAsMoment.format(format) : latestPeriodAsMoment,\n      submissionPeriods: submissionPeriods.toJS(),\n      latestPeriod: latestPeriod\n    }));\n  }, \"useLatestAccountData{[latestPeriodAsMoment, submissionPeriods, latestPeriod, isLoading, errorMsg]}\", function () {\n    return [useLatestAccountData];\n  });\n};\nvar _default = withLatestFy;\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (_default);\n;\n(function () {\n  var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;\n  if (!reactHotLoader) {\n    return;\n  }\n  reactHotLoader.register(useLatestAccountData, \"useLatestAccountData\", \"C:\\\\Firebase\\\\Reports-Firebase\\\\src\\\\js\\\\containers\\\\account\\\\WithLatestFy.jsx\");\n  reactHotLoader.register(useValidTimeBasedQueryParams, \"useValidTimeBasedQueryParams\", \"C:\\\\Firebase\\\\Reports-Firebase\\\\src\\\\js\\\\containers\\\\account\\\\WithLatestFy.jsx\");\n  reactHotLoader.register(withLatestFy, \"withLatestFy\", \"C:\\\\Firebase\\\\Reports-Firebase\\\\src\\\\js\\\\containers\\\\account\\\\WithLatestFy.jsx\");\n  reactHotLoader.register(_default, \"default\", \"C:\\\\Firebase\\\\Reports-Firebase\\\\src\\\\js\\\\containers\\\\account\\\\WithLatestFy.jsx\");\n})();\n;\n(function () {\n  var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;\n  leaveModule && leaveModule(module);\n})();\n\n//# sourceURL=webpack:///./js/containers/account/WithLatestFy.jsx?");

/***/ })

}]);